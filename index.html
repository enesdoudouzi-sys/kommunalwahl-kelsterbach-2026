<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Kommunalwahl Kelsterbach – Stimmungsbild</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#f6f8fb;
  --card:#ffffff;
  --primary:#0f172a;
  --muted:#475569;
  --accent:#2563eb;
  --accent-soft:#e0e7ff;
  --border:#e2e8f0;
  --neutral:#94a3b8;
}
*{box-sizing:border-box;}
body{
  font-family:Inter,system-ui,sans-serif;
  max-width:980px;
  margin:2.5rem auto;
  padding:0 1.25rem;
  background:var(--bg);
  color:var(--primary);
}
section{
  background:var(--card);
  padding:1.75rem;
  border-radius:20px;
  margin-bottom:2rem;
  border:1px solid var(--border);
}
label{
  display:flex;
  gap:.75rem;
  padding:.8rem 1rem;
  border-radius:14px;
  cursor:pointer;
}
label:hover{background:var(--accent-soft);}
button{
  margin-top:1rem;
  padding:.7rem 1.6rem;
  font-weight:600;
  border:none;
  border-radius:999px;
  background:var(--accent);
  color:#fff;
  cursor:pointer;
}
.result{
  margin-bottom:1rem;
  padding:.6rem .8rem;
  border-radius:14px;
  background:#f8fafc;
}
.bar{
  height:16px;
  border-radius:999px;
  margin-top:.3rem;
  min-width:6px;
}
.bar.main{background:linear-gradient(90deg,var(--accent),#60a5fa);}
.bar.neutral{background:linear-gradient(90deg,var(--neutral),#cbd5e1);}
.small{font-size:.85rem;color:var(--muted);}
</style>
</head>

<body>

<header>
  <h1>Kommunalwahl Kelsterbach</h1>
  <p class="small">Freiwilliges, nicht repräsentatives Stimmungsbild · anonym</p>
</header>

<section>
<h2>Frage</h2>
<p><strong>Wenn bei der nächsten Kommunalwahl gewählt würde – wen würden Sie wählen?</strong></p>
<p class="small">Eine Teilnahme pro Gerät empfohlen · Daten bleiben lokal im Browser</p>

<form id="voteForm"></form>
<button id="voteBtn">Stimme abgeben</button>
<p id="thanks" class="small" style="display:none">Danke für Ihre Teilnahme.</p>
</section>

<section>
<h2>Ergebnisse</h2>
<label class="small">
Zeitraum:
<select id="range">
  <option value="all">Gesamt</option>
  <option value="7">Letzte 7 Tage</option>
  <option value="30">Letzte 30 Tage</option>
</select>
</label>
<div id="results"></div>
</section>

<section>
<h2>Transparenz</h2>
<div id="meta" class="small"></div>
<button id="exportBtn">Ergebnis exportieren (JSON)</button>
<button id="resetBtn">Lokale Daten löschen</button>
</section>

<script>
const PARTIES=[
  "CDU","Die Linke","EUK","FDP","Freie Wähler",
  "HAK","SPD","WIK + FNK","Unentschlossen"
];
const KEY="kelsterbach_votes_v3";
const VOTED_KEY="kelsterbach_voted";

if(!localStorage.getItem(KEY)){
  const init={};
  PARTIES.forEach(p=>init[p]=[]);
  localStorage.setItem(KEY,JSON.stringify(init));
}

const form=document.getElementById("voteForm");
PARTIES.forEach(p=>{
  form.innerHTML+=\`
  <label><input type="radio" name="vote" value="\${p}"> \${p}</label>\`;
});

const voteBtn=document.getElementById("voteBtn");
if(localStorage.getItem(VOTED_KEY)) voteBtn.disabled=true;

voteBtn.onclick=()=>{
  const c=document.querySelector('input[name="vote"]:checked');
  if(!c) return;

  const data=JSON.parse(localStorage.getItem(KEY));
  data[c.value].push(Date.now());
  localStorage.setItem(KEY,JSON.stringify(data));
  localStorage.setItem(VOTED_KEY,"true");

  voteBtn.disabled=true;
  document.getElementById("thanks").style.display="block";
  setTimeout(()=>document.getElementById("thanks").style.display="none",2500);
  render();
};

document.getElementById("range").onchange=render;

function render(){
  const range=document.getElementById("range").value;
  const since=range==="all"?0:Date.now()-range*86400000;
  const data=JSON.parse(localStorage.getItem(KEY));
  let sum=0;
  const totals={};

  PARTIES.forEach(p=>{
    totals[p]=data[p].filter(t=>t>=since).length;
    sum+=totals[p];
  });

  const out=document.getElementById("results");
  out.innerHTML="";
  PARTIES.forEach(p=>{
    const v=totals[p];
    const pc=sum?(v/sum*100).toFixed(1):0;
    out.innerHTML+=\`
    <div class="result">
      <strong>\${p}: \${pc}% (\${v})</strong>
      <div class="bar \${p==="Unentschlossen"?"neutral":"main"}" style="width:\${pc}%"></div>
    </div>\`;
  });

  const allTimes=Object.values(data).flat();
  document.getElementById("meta").innerText=
    "Gesamtstimmen (lokal): "+allTimes.length+
    " · Erste: "+(allTimes[0]?new Date(Math.min(...allTimes)).toLocaleDateString():"-")+
    " · Letzte: "+(allTimes[0]?new Date(Math.max(...allTimes)).toLocaleDateString():"-");
}

document.getElementById("exportBtn").onclick=()=>{
  const blob=new Blob([localStorage.getItem(KEY)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="stimmungsbild.json";
  a.click();
};

document.getElementById("resetBtn").onclick=()=>{
  if(confirm("Lokale Daten wirklich löschen?")){
    localStorage.removeItem(KEY);
    localStorage.removeItem(VOTED_KEY);
    location.reload();
  }
};

render();
</script>

</body>
</html>
